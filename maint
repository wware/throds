#!/bin/bash

# dotted python version, e.g. "2.7"
PYDVER=$(python -c "import sys; print sys.version[:3]")

case "$(uname -s)" in
    Linux*)
      INCL=-I/usr/include/python${PYDVER}
    ;;
    Darwin*)
      INCL=-I/System/Library/Frameworks/Python.framework/Versions/${PYDVER}/include/python${PYDVER}
      # LDSHARED="mpicc -bundle -undefined dynamic_lookup -DOMPI_IMPORTS"
      LDSHARED="-undefined dynamic_lookup -DOMPI_IMPORTS"
    ;;
    CYGWIN*)    ;;
    MINGW*)     ;;
    *)          machine="UNKNOWN:${unameOut}"
esac

cython vector.pyx || exit 1
gcc -shared -pthread -fPIC -fwrapv -O2 -Wall \
  -fno-strict-aliasing ${LDSHARED} ${INCL} -o vector.so vector.c || exit 1
pylint *.py && flake8 *.py && nosetests *.py
